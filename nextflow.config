params {

	// WORKFLOW PARAMETERS TO REVIEW AT EACH RUN
	// ----------------------------------------

	// Path to parent directory of Nanopore reads in base-called FASTQ-format
	// Expects FASTQs to be gzipped in barcode subdirectories (barcode01/, barcode02/, etc.)
	// All barcode directories matching "barcode*" will be auto-detected
	fastq_dir = ""

	// CSV specifying primer IDs and sequences for chain classification
	// Reads are classified as heavy or light chain based on primer sequence matching
	primer_table = "$projectDir/resources/bovine_primers.csv"

	// Where to place results
	results = "$launchDir/results"

	// Minimum required number of reads per sample
	min_reads = 100

	// Minimum expected length of each amplicon
	min_len = 400

	// Maximum expected length of each amplicon
	max_len = 800

	// Minimum quality score for filtering
	min_qual = 10

	// Max number of mismatches allowed in primer sequences (0-3, bbduk limit)
	primer_mismatch = 2

	// Amplicon sorter similarity thresholds (tuned for bovine IgG)
	// -sg: threshold for initial grouping (default 80)
	similar_genes = 85
	// -ss: threshold to ADD sequences to groups (default 85)
	similar_species = 90
	// -sc: threshold to COMBINE groups into consensus (default 96)
	similar_consensus = 98
	// -ldc: length variance % for combining groups (default 8)
	length_diff_consensus = 5
	// -amb: include ambiguous nucleotides for SNP detection
	use_ambiguous = true

	// Maximum reads to process per sample (for amplicon_sorter)
	max_reads = 100000

	// Whether to cleanup the work directory after a successful run
	cleanup = false

	// Whether to terminate the workflow with errors (for debugging)
	debugmode = false

	// Directory containing bovine germline gene FASTA files from IMGT
	// Required files: bovine_IGHV.fasta, bovine_IGHD.fasta, bovine_IGHJ.fasta,
	//                 bovine_IGKV.fasta, bovine_IGKJ.fasta, bovine_IGLV.fasta, bovine_IGLJ.fasta
	// See resources/imgt_bovine_urls.txt for download instructions
	germline_dir = "$projectDir/resources/germlines"

	// Skip IgBLAST annotation if germline files not available
	skip_annotation = false

}


// WHETHER TO GENERATE A REPORT OF RUN STATISTICS
report {
	enabled = true
	overwrite = true
	file = "${params.results}/report.html"
}


// WHETHER TO GENERATE A VISUALIZATION OF THE WORKFLOW
dag {
	enabled = false
	overwrite = true
	file = 'workflow-visualization.png'
}

trace {
	enabled = false
	file = "${params.results}/pipeline_trace.txt"
	fields = 'task_id,name,status,exit,realtime,%cpu,rss'
}


// WHETHER TO REMOVE TEMPORARY FILES AFTER A SUCCESSFUL RUN
cleanup = params.cleanup


// PROFILE OPTIONS
profiles {

	standard {
		docker.enabled = true
		singularity.enabled = false
		conda.enabled = false
		process.container = "nrminor/sort-and-assemble:v0.0.7"
	}

	docker {
		docker.enabled = true
		singularity.enabled = false
		conda.enabled = false
		process.container = "nrminor/sort-and-assemble:v0.0.7"
	}

	apptainer {
		apptainer.enabled = true
		docker.enabled = false
		conda.enabled = false
		process.container = "nrminor/sort-and-assemble:v0.0.7"
	}

}


// MANIFEST
manifest {
	homePage = 'https://github.com/fruggles11/bovine-igg-pipeline'
	mainScript = 'main.nf'
	defaultBranch = 'main'
	description = 'Bovine IgG repertoire analysis pipeline for Oxford Nanopore data'
	author = 'fruggles11'
}
